---
// src/pages/blog/[tag].astro

import Badge from "@/components/ui/Badge.astro";
import BlogLayout from "@/layouts/BlogLayout.astro";
import { getCollection } from "astro:content";

// Obtener todos los posts de la colección
const allPosts = await getCollection("posts");

// Generar las rutas estáticas para cada tag
export async function getStaticPaths() {
  const allPosts = await getCollection("posts");
  // Obtener todos los tags únicos de los posts
  const allTags = new Set(allPosts.flatMap((post) => post.data.tags || []));

  // Generar las rutas estáticas para cada tag
  return Array.from(allTags).map((tag) => ({
    params: { tag },
    props: { tag },
  }));
}

// Obtener el parámetro de la URL (el tag)
const { tag } = Astro.params;

// Filtrar los posts que contengan el tag especificado
const filteredPosts = allPosts.filter(
  (post) => post.data.tags && post.data.tags.includes(tag)
);
---

<BlogLayout
  title=`Raul Salomon - Categoría ${tag}`
  description=`Publicaciones de blog pertenecientes a la categoría ${tag}`
>
  <!-- BlogGrid -->
  <div
    class="content grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-8"
  >
    {
      filteredPosts.map((post) => {
        const { id, data } = post;
        const { title, description, image, pubDate, tags } = data;

        return (
          <div class="bg-white rounded-lg shadow-md overflow-hidden transition-transform hover:scale-105">
            <img
              src={image || "images/placeholder.webp"}
              alt={title}
              transition:name={`img-${id}`}
              width={400}
              height={200}
              class="w-full h-48 object-cover"
            />
            <div class="p-6">
              <div class="flex flex-wrap gap-2">
                {tags?.map((tag) => {
                  return <Badge text={tag} />;
                })}
              </div>
              <h2 class="text-xl font-bold mt-2 mb-2">{title}</h2>
              <p class="text-gray-600 mb-4">{description}</p>
              <a
                href={`/blog/${id}`}
                class="text-indigo-600 font-semibold hover:underline"
              >
                Read More
              </a>
            </div>
          </div>
        );
      })
    }
  </div>
</BlogLayout>
