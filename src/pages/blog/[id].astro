---
import { getCollection, render } from "astro:content";

import Sidebar from "@/components/Sidebar.astro";
import Comments from "@/components/Comments.astro";
import BlogLayout from "@/layouts/BlogLayout.astro";

export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return posts.map((post) => ({
    params: { id: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { id, data } = post;
const {
  title,
  description,
  image,
  pubDate,
  authorType,
  author,
  externalAuthor,
  source,
  tags,
  draft,
} = data;

const { Content } = await render(post);
---

<BlogLayout title=`Raul Salomon - ${title}` description={title}>
  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col md:flex-row">
      <article class="md:w-2/3 md:pr-8">
        <img
          src={image || "/images/placeholder.svg"}
          alt={title}
          transition:name={`img-${id}`}
          width={800}
          height={400}
          class="w-full h-64 object-cover rounded-lg mb-6"
        />
        <h1 class="text-3xl font-bold mb-4">{title}</h1>
        <div class="text-gray-600 mb-4">
          <span>{pubDate}</span> â€¢ <span>{author}</span>
        </div>
        <div class="prose max-w-none mb-12">
          <Content />
        </div>
        <Comments />
      </article>
      <Sidebar class="md:w-1/3 mt-8 md:mt-0" />
    </div>
  </div>
</BlogLayout>
